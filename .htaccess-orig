Options +FollowSymLinks

php_flag register_globals 0
php_flag magic_quotes_gpc Off

AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css application/javascript application/x-javascript application/x-httpd-php application/rss+xml application/atom_xml text/javascript

RewriteEngine On
RewriteBase /

AddDefaultCharset UTF-8

<IfModule !mod_dav.c>
# LIVE
# Used for maintenance - adjust IP address
#RewriteCond %{REMOTE_ADDR} !79.243.204.101 [NC]
#RewriteCond %{REMOTE_ADDR} !85.13.144.92 [NC]	#pamfax.biz
#RewriteCond %{REMOTE_ADDR} !85.13.144.93 [NC]	#pamfax.biz
#RewriteCond %{REMOTE_ADDR} !85.13.144.94 [NC]	#pamfax.biz
#RewriteCond %{REQUEST_URI} !upgr.html	[NC]
#RewriteCond %{REQUEST_URI} !images/	[NC]
#RewriteRule (.*) http://www.pamfax.biz/upgr.html [R=307,L]

# we are NOT updating ATM:
#RewriteCond %{REQUEST_URI} upgrade.html	[NC]
#RewriteCond %{QUERY_STRING} !.*test=1
#RewriteRule (.*) http://www.pamfax.biz/ [R=307,L]

# short urls redirection
#RewriteCond %{HTTP:X-Forwarded-Proto} !=https [NC]
RewriteCond %{HTTP_HOST} ^go\.pamfax\.biz$ [NC]
RewriteCond %{REQUEST_URI} ^/([0-9a-zA-Z]+)$
RewriteRule . go.php?uri=%{HTTP_HOST}%{REQUEST_URI} [L]

# if requested hostname does NOT start with allowed subdomain
RewriteCond %{HTTP_HOST} !^www\.
RewriteCond %{HTTP_HOST} !^beta\.
RewriteCond %{HTTP_HOST} !^s\.
# get hostname to %1 variable
RewriteCond %{HTTP_HOST} (pamfax\.(de|com|jp|biz|net|es|cn|ru|it|eu|pl|fr)$)
# prepend "www." to requested hostname and file
RewriteRule (.*) http://www.%1%{REQUEST_URI} [R=301,L,QSA]
</IfModule>

<IfModule mod_dav.c>
# DEV
# short urls redirection
RewriteCond %{HTTP_HOST} ^dev\.pamfax\.biz$ [NC]
RewriteCond %{REQUEST_URI} ^/go([0-9a-zA-Z]+)$
RewriteRule . go.php?uri=%{HTTP_HOST}%{REQUEST_URI} [L]

# if requested hostname does NOT start with allowed subdomain
RewriteCond %{HTTP_HOST} !^dev\.
# get hostname to %1 variable
RewriteCond %{HTTP_HOST} (pamfax\.(de|com|jp|biz|net|es|cn|ru|it|eu|pl|fr)$)
# prepend "www." to requested hostname and file
RewriteRule (.*) http://www.%1%{REQUEST_URI} [R=301,L,QSA]
</IfModule>

RewriteCond %{HTTP_HOST} ^www\.pamfax\.net$
RewriteCond %{REQUEST_URI} !^(.*\.(gif|jpg|png|js|css|ico))$ [NC]
RewriteRule (.*) http://www.pamfax.biz%{REQUEST_URI} [R=301,L,QSA]

ErrorDocument 400 /400.php
ErrorDocument 401 /401.php
ErrorDocument 403 /403.php
ErrorDocument 404 /404.php
ErrorDocument 412 /412.php
ErrorDocument 500 /500.php

RewriteCond %{HTTP:X-Forwarded-Proto} =https [NC]
RewriteCond %{HTTP_HOST} ^(dev\.|go\.)pamfax\.biz$ [NC]
RewriteCond %{REQUEST_URI} ^/([0-9a-zA-Z]+)$
RewriteRule (.*) https://www.pamfax.biz/go.php?uri=%{HTTP_HOST}%{REQUEST_URI} [L]

# redir non-existant domains to .biz
RewriteCond %{HTTP_HOST} !\.(pamfax\.(de|com|jp|biz|net|es|cn|ru|it|eu|pl|fr)$)
RewriteCond %{HTTP_HOST} !.pamweb-1.kasserver.com
RewriteCond %{HTTP_HOST} !.pamweb-2.kasserver.com
RewriteRule (.*) http://www.pamfax.biz/ [R=301,L,QSA]

# shop Redirect
RewriteRule ^(en|de|ja|es|ru|it|pl|zh-Hant|zh-Hans|fr|sv)/shop/(.*) https://%{HTTP_HOST}/shop/$2?language_code=$1 [R=302,L,QSA]

# correct lowercase cn urls
RewriteRule ^zh-han(t|s)(/(.*)|$) /zh-Han$1/$2/ [R=301,L,QSA]

# append / for start page if missing
RewriteRule ^(en|de|ja|it|pl|ru|es|zh-Hant|zh-Hans|fr|sv)$ /$1/ [R=301,L,QSA]

# cn has changed to zh-Hans
RewriteRule ^cn(/(.*)|$) zh-Hans/$1 [R=301,L,QSA]

# redir non-existant urls from .net to .biz
#RewriteCond %{HTTP_HOST} (pamfax\.net)$
#RewriteCond %{REQUEST_FILENAME} -f [OR]
#RewriteCond %{REQUEST_FILENAME} -d
#RewriteRule (.*) http://www.pamfax.biz/ [R=301,L,QSA]

RewriteCond %{HTTP_HOST} ^(dev\.|beta\.|go\.)pamfax\.biz$ [NC]
RewriteCond %{REQUEST_URI} ^/robots.txt$
RewriteRule . robots_blockall.txt [L]


<IfModule mod_dav.c>
# DEV
#php_value error_log /srv/www/htdocs/3.0/.logs/phperror_website.log
#php_flag display_errors On
#php_flag log_errors On

# secure some pages
RewriteCond %{HTTPS} off [NC]
RewriteCond %{REQUEST_URI} wp-login.php [NC,OR]
RewriteCond %{REQUEST_URI} wp-admin [NC]
RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L,QSA]

# only .biz pages are available ssl secured. redirect others to http
RewriteCond %{HTTPS} on [NC]
RewriteCond %{REQUEST_URI} !wp-login.php [NC]
RewriteCond %{REQUEST_URI} !wp-admin [NC]
RewriteCond %{HTTP_HOST} !\.pamfax\.biz [NC]
RewriteRule (.*) http://%{HTTP_HOST}%{REQUEST_URI} [R=301,L,QSA]

SetEnvIf Request_URI (.*) PAMFAX_DOWNLOAD_URI=http://dev-download.pamfax.biz/

# domain redirects
RewriteCond %{HTTP_HOST} ^dev\.pamfax\.de [NC]
RewriteRule (.*) http://dev.pamfax.biz/de/$1 [R=301,L,QSA]
RewriteCond %{HTTP_HOST} ^dev\.pamfax\.jp [NC]
RewriteRule (.*) http://dev.pamfax.biz/ja/$1 [R=301,L,QSA] 
RewriteCond %{HTTP_HOST} ^dev\.pamfax\.com [NC]
RewriteRule (.*) http://dev.pamfax.biz/en/$1 [R=301,L,QSA]
</IfModule>

SetEnvIf Cookie "fakegeoipcountry=([A-Z]*)" GEOIP_COUNTRY_CODE=$1

<IfModule !mod_dav.c>
# LIVE

# default indetectable geoip to US:
SetEnvIf GEOIP_COUNTRY_CODE ^$ GEOIP_COUNTRY_CODE=US

# memcache sessions:
php_value session.save_handler memcache
php_value session.save_path    "tcp://85.13.144.91:11211"

# secure some pages
RewriteCond %{HTTP:X-Forwarded-Proto} !=https [NC]
RewriteCond %{REQUEST_URI} wp-login.php [NC,OR]
RewriteCond %{REQUEST_URI} wp-admin [NC]
RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L,QSA]

# only .biz pages are available ssl secured. redirect others to http
RewriteCond %{HTTP:X-Forwarded-Proto} =https [NC]
RewriteCond %{REQUEST_URI} !wp-login.php [NC]
RewriteCond %{REQUEST_URI} !wp-admin [NC]
RewriteCond %{HTTP_HOST} !\.pamfax\.biz [NC]
RewriteRule (.*) http://%{HTTP_HOST}%{REQUEST_URI} [R=301,L,QSA]

# set global var for later use (note: setenv module is not installed on server, but setenvif is available)
SetEnvIf Request_URI (.*) PAMFAX_DOWNLOAD_URI=http://download.pamfax.biz/

php_value error_log /www/htdocs/w008b779/3.0/website/wp-content/phperror.log
php_flag display_errors Off
php_flag log_errors On

# Suhosin changes
#php_value suhosin.session.encrypt 0

# domain redirects
RewriteCond %{HTTP_HOST} ^www\.pamfax\.de [NC]
RewriteRule (.*) http://www.pamfax.biz/de/$1 [R=301,L,QSA]
RewriteCond %{HTTP_HOST} ^www\.pamfax\.jp [NC]
RewriteRule (.*) http://www.pamfax.biz/ja/$1 [R=301,L,QSA]
RewriteCond %{HTTP_HOST} ^www\.pamfax\.com [NC]
RewriteRule (.*) http://www.pamfax.biz/en/$1 [R=301,L,QSA]
RewriteCond %{HTTP_HOST} ^www\.pamfax\.it [NC]
RewriteRule (.*) http://www.pamfax.biz/it/$1 [R=301,L,QSA]
RewriteCond %{HTTP_HOST} ^www\.pamfax\.pl [NC]
RewriteRule (.*) http://www.pamfax.biz/pl/$1 [R=301,L,QSA]
RewriteCond %{HTTP_HOST} ^www\.pamfax\.cn [NC]
RewriteRule (.*) http://www.pamfax.biz/zh-Hans/$1 [R=301,L,QSA]
RewriteCond %{HTTP_HOST} ^www\.pamfax\.ru [NC]
RewriteRule (.*) http://www.pamfax.biz/ru/$1 [R=301,L,QSA]
RewriteCond %{HTTP_HOST} ^www\.pamfax\.es [NC]
RewriteRule (.*) http://www.pamfax.biz/es/$1 [R=301,L,QSA]
RewriteCond %{HTTP_HOST} ^www\.pamfax\.fr [NC]
RewriteRule (.*) http://www.pamfax.biz/fr/$1 [R=301,L,QSA]
RewriteCond %{HTTP_HOST} ^www\.pamfax\.eu [NC]
RewriteRule (.*) http://www.pamfax.biz/$1 [R=301,L,QSA]
</IfModule>

<IfModule mod_dav.c>
# DEV
# memcache sessions:
php_value session.save_handler files
#php_value session.save_path    "tcp://dev-dev.pamfax.biz:11211"

# default indetectable geoip to DE:
SetEnvIf GEOIP_COUNTRY_CODE ^$ GEOIP_COUNTRY_CODE=DE
</IfModule>

# block unsupported browsers
RewriteCond %{HTTP_USER_AGENT} MSIE\ 6\. [OR]
RewriteCond %{HTTP_USER_AGENT} Firefox\/3\.0
RewriteCond %{REQUEST_URI} !/unsupported_browser.php  [NC]
RewriteRule (.*) /unsupported_browser.php [R=302,L]

RewriteCond %{HTTP_USER_AGENT} !MSIE\ 6\.
RewriteCond %{HTTP_USER_AGENT} !Firefox\/3\.0
RewriteCond %{REQUEST_URI} /unsupported_browser.php  [NC]
RewriteRule (.*) / [R=302,L]

# BEGIN WPSuperCache
<IfModule mod_rewrite.c>
#If you serve pages from behind a proxy you may want to change 'RewriteCond %{HTTPS} on' to something more sensible
RewriteCond %{REQUEST_URI} !^.*[^/]$
RewriteCond %{REQUEST_URI} !^.*//.*$
RewriteCond %{REQUEST_METHOD} !POST
RewriteCond %{QUERY_STRING} !.*=.*
RewriteCond %{HTTP:Cookie} !^.*(comment_author_|wordpress_logged_in|wp-postpass_|wploggedin|fakegeoipcountry).*$
RewriteCond %{HTTP:X-Wap-Profile} !^[a-z0-9\"]+ [NC]
RewriteCond %{HTTP:Profile} !^[a-z0-9\"]+ [NC]
RewriteCond %{HTTP_USER_AGENT} !^.*(2.0\ MMP|240x320|400X240|AvantGo|BlackBerry|Blazer|Cellphone|Danger|DoCoMo|Elaine/3.0|EudoraWeb|Googlebot-Mobile|hiptop|IEMobile|KYOCERA/WX310K|LG/U990|MIDP-2.|MMEF20|MOT-V|NetFront|Newt|Nintendo\ Wii|Nitro|Nokia|Opera\ Mini|Palm|PlayStation\ Portable|portalmmm|Proxinet|ProxiNet|SHARP-TQ-GX10|SHG-i900|Small|SonyEricsson|Symbian\ OS|SymbianOS|TS21i-10|UP.Browser|UP.Link|webOS|Windows\ CE|WinWAP|YahooSeeker/M1A1-R2D2|iPhone|iPod|Android|BlackBerry9530|LG-TU915\ Obigo|LGE\ VX|webOS|Nokia5800).* [NC]
RewriteCond %{HTTP_user_agent} !^(w3c\ |w3c-|acs-|alav|alca|amoi|audi|avan|benq|bird|blac|blaz|brew|cell|cldc|cmd-|dang|doco|eric|hipt|htc_|inno|ipaq|ipod|jigs|kddi|keji|leno|lg-c|lg-d|lg-g|lge-|lg/u|maui|maxo|midp|mits|mmef|mobi|mot-|moto|mwbp|nec-|newt|noki|palm|pana|pant|phil|play|port|prox|qwap|sage|sams|sany|sch-|sec-|send|seri|sgh-|shar|sie-|siem|smal|smar|sony|sph-|symb|t-mo|teli|tim-|tosh|tsm-|upg1|upsi|vk-v|voda|wap-|wapa|wapi|wapp|wapr|webc|winw|winw|xda\ |xda-).* [NC]
RewriteCond %{HTTP:Accept-Encoding} gzip
RewriteCond %{HTTP:X-Forwarded-Proto} =https [NC]
RewriteCond %{DOCUMENT_ROOT}/wp-content/cache/supercache/%{HTTP_HOST}/%{ENV:GEOIP_COUNTRY_CODE}/$1/index-https.html.gz -f
RewriteRule ^(.*) "/wp-content/cache/supercache/%{HTTP_HOST}/%{ENV:GEOIP_COUNTRY_CODE}/$1/index-https.html.gz" [L]

RewriteCond %{REQUEST_URI} !^.*[^/]$
RewriteCond %{REQUEST_URI} !^.*//.*$
RewriteCond %{REQUEST_METHOD} !POST
RewriteCond %{QUERY_STRING} !.*=.*
RewriteCond %{HTTP:Cookie} !^.*(comment_author_|wordpress_logged_in|wp-postpass_|wploggedin|fakegeoipcountry).*$
RewriteCond %{HTTP:X-Wap-Profile} !^[a-z0-9\"]+ [NC]
RewriteCond %{HTTP:Profile} !^[a-z0-9\"]+ [NC]
RewriteCond %{HTTP_USER_AGENT} !^.*(2.0\ MMP|240x320|400X240|AvantGo|BlackBerry|Blazer|Cellphone|Danger|DoCoMo|Elaine/3.0|EudoraWeb|Googlebot-Mobile|hiptop|IEMobile|KYOCERA/WX310K|LG/U990|MIDP-2.|MMEF20|MOT-V|NetFront|Newt|Nintendo\ Wii|Nitro|Nokia|Opera\ Mini|Palm|PlayStation\ Portable|portalmmm|Proxinet|ProxiNet|SHARP-TQ-GX10|SHG-i900|Small|SonyEricsson|Symbian\ OS|SymbianOS|TS21i-10|UP.Browser|UP.Link|webOS|Windows\ CE|WinWAP|YahooSeeker/M1A1-R2D2|iPhone|iPod|Android|BlackBerry9530|LG-TU915\ Obigo|LGE\ VX|webOS|Nokia5800).* [NC]
RewriteCond %{HTTP_user_agent} !^(w3c\ |w3c-|acs-|alav|alca|amoi|audi|avan|benq|bird|blac|blaz|brew|cell|cldc|cmd-|dang|doco|eric|hipt|htc_|inno|ipaq|ipod|jigs|kddi|keji|leno|lg-c|lg-d|lg-g|lge-|lg/u|maui|maxo|midp|mits|mmef|mobi|mot-|moto|mwbp|nec-|newt|noki|palm|pana|pant|phil|play|port|prox|qwap|sage|sams|sany|sch-|sec-|send|seri|sgh-|shar|sie-|siem|smal|smar|sony|sph-|symb|t-mo|teli|tim-|tosh|tsm-|upg1|upsi|vk-v|voda|wap-|wapa|wapi|wapp|wapr|webc|winw|winw|xda\ |xda-).* [NC]
RewriteCond %{HTTP:Accept-Encoding} gzip
RewriteCond %{HTTP:X-Forwarded-Proto} !=https [NC]
RewriteCond %{DOCUMENT_ROOT}/wp-content/cache/supercache/%{HTTP_HOST}/%{ENV:GEOIP_COUNTRY_CODE}/$1/index.html.gz -f
RewriteRule ^(.*) "/wp-content/cache/supercache/%{HTTP_HOST}/%{ENV:GEOIP_COUNTRY_CODE}/$1/index.html.gz" [L]

RewriteCond %{REQUEST_URI} !^.*[^/]$
RewriteCond %{REQUEST_URI} !^.*//.*$
RewriteCond %{REQUEST_METHOD} !POST
RewriteCond %{QUERY_STRING} !.*=.*
RewriteCond %{HTTP:Cookie} !^.*(comment_author_|wordpress_logged_in|wp-postpass_|wploggedin|fakegeoipcountry).*$
RewriteCond %{HTTP:X-Wap-Profile} !^[a-z0-9\"]+ [NC]
RewriteCond %{HTTP:Profile} !^[a-z0-9\"]+ [NC]
RewriteCond %{HTTP_USER_AGENT} !^.*(2.0\ MMP|240x320|400X240|AvantGo|BlackBerry|Blazer|Cellphone|Danger|DoCoMo|Elaine/3.0|EudoraWeb|Googlebot-Mobile|hiptop|IEMobile|KYOCERA/WX310K|LG/U990|MIDP-2.|MMEF20|MOT-V|NetFront|Newt|Nintendo\ Wii|Nitro|Nokia|Opera\ Mini|Palm|PlayStation\ Portable|portalmmm|Proxinet|ProxiNet|SHARP-TQ-GX10|SHG-i900|Small|SonyEricsson|Symbian\ OS|SymbianOS|TS21i-10|UP.Browser|UP.Link|webOS|Windows\ CE|WinWAP|YahooSeeker/M1A1-R2D2|iPhone|iPod|Android|BlackBerry9530|LG-TU915\ Obigo|LGE\ VX|webOS|Nokia5800).* [NC]
RewriteCond %{HTTP_user_agent} !^(w3c\ |w3c-|acs-|alav|alca|amoi|audi|avan|benq|bird|blac|blaz|brew|cell|cldc|cmd-|dang|doco|eric|hipt|htc_|inno|ipaq|ipod|jigs|kddi|keji|leno|lg-c|lg-d|lg-g|lge-|lg/u|maui|maxo|midp|mits|mmef|mobi|mot-|moto|mwbp|nec-|newt|noki|palm|pana|pant|phil|play|port|prox|qwap|sage|sams|sany|sch-|sec-|send|seri|sgh-|shar|sie-|siem|smal|smar|sony|sph-|symb|t-mo|teli|tim-|tosh|tsm-|upg1|upsi|vk-v|voda|wap-|wapa|wapi|wapp|wapr|webc|winw|winw|xda\ |xda-).* [NC]
RewriteCond %{HTTP:X-Forwarded-Proto} =https [NC]
RewriteCond %{DOCUMENT_ROOT}/wp-content/cache/supercache/%{HTTP_HOST}/%{ENV:GEOIP_COUNTRY_CODE}/$1/index-https.html -f
RewriteRule ^(.*) "/wp-content/cache/supercache/%{HTTP_HOST}/%{ENV:GEOIP_COUNTRY_CODE}/$1/index-https.html" [L]

RewriteCond %{REQUEST_URI} !^.*[^/]$
RewriteCond %{REQUEST_URI} !^.*//.*$
RewriteCond %{REQUEST_METHOD} !POST
RewriteCond %{QUERY_STRING} !.*=.*
RewriteCond %{HTTP:Cookie} !^.*(comment_author_|wordpress_logged_in|wp-postpass_|wploggedin|fakegeoipcountry).*$
RewriteCond %{HTTP:X-Wap-Profile} !^[a-z0-9\"]+ [NC]
RewriteCond %{HTTP:Profile} !^[a-z0-9\"]+ [NC]
RewriteCond %{HTTP_USER_AGENT} !^.*(2.0\ MMP|240x320|400X240|AvantGo|BlackBerry|Blazer|Cellphone|Danger|DoCoMo|Elaine/3.0|EudoraWeb|Googlebot-Mobile|hiptop|IEMobile|KYOCERA/WX310K|LG/U990|MIDP-2.|MMEF20|MOT-V|NetFront|Newt|Nintendo\ Wii|Nitro|Nokia|Opera\ Mini|Palm|PlayStation\ Portable|portalmmm|Proxinet|ProxiNet|SHARP-TQ-GX10|SHG-i900|Small|SonyEricsson|Symbian\ OS|SymbianOS|TS21i-10|UP.Browser|UP.Link|webOS|Windows\ CE|WinWAP|YahooSeeker/M1A1-R2D2|iPhone|iPod|Android|BlackBerry9530|LG-TU915\ Obigo|LGE\ VX|webOS|Nokia5800).* [NC]
RewriteCond %{HTTP_user_agent} !^(w3c\ |w3c-|acs-|alav|alca|amoi|audi|avan|benq|bird|blac|blaz|brew|cell|cldc|cmd-|dang|doco|eric|hipt|htc_|inno|ipaq|ipod|jigs|kddi|keji|leno|lg-c|lg-d|lg-g|lge-|lg/u|maui|maxo|midp|mits|mmef|mobi|mot-|moto|mwbp|nec-|newt|noki|palm|pana|pant|phil|play|port|prox|qwap|sage|sams|sany|sch-|sec-|send|seri|sgh-|shar|sie-|siem|smal|smar|sony|sph-|symb|t-mo|teli|tim-|tosh|tsm-|upg1|upsi|vk-v|voda|wap-|wapa|wapi|wapp|wapr|webc|winw|winw|xda\ |xda-).* [NC]
RewriteCond %{HTTP:X-Forwarded-Proto} !=https [NC]
RewriteCond %{DOCUMENT_ROOT}/wp-content/cache/supercache/%{HTTP_HOST}/%{ENV:GEOIP_COUNTRY_CODE}/$1/index.html -f
RewriteRule ^(.*) "/wp-content/cache/supercache/%{HTTP_HOST}/%{ENV:GEOIP_COUNTRY_CODE}/$1/index.html" [L]
</IfModule>
# END WPSuperCache

#disallow phperror.log access
RewriteRule ^phperror$ . [NC,F]

# mac download
RewriteRule ^(en/|de/|)getPamFax.dmg %{ENV:PAMFAX_DOWNLOAD_URI}files/PamFaxInstaller.dmg [L,QSA]

# windows download (from various urls)
RewriteRule ^(en/|de/|)getPamFaxClient %{ENV:PAMFAX_DOWNLOAD_URI}files/PamFaxInstaller.exe [L,R]
RewriteRule ^(en/|de/|)getPamFax.exe %{ENV:PAMFAX_DOWNLOAD_URI}files/PamFaxInstaller.exe [L,QSA]
RewriteRule ^(en/|de/|)getpamfax.exe %{ENV:PAMFAX_DOWNLOAD_URI}files/PamFaxInstaller.exe [L,QSA]
RewriteRule ^(en/|de/|)getPamFax %{ENV:PAMFAX_DOWNLOAD_URI}files/PamFaxInstaller.exe [L,R]

# Affiliate Versions:
RewriteCond %{QUERY_STRING} a=([0-9]{3}) [NC]
RewriteRule ^PamFaxInstaller.exe %{ENV:PAMFAX_DOWNLOAD_URI}files/PamFaxInstallerA%1.exe [L,QSA]
RewriteCond %{QUERY_STRING} a=([0-9]{3}) [NC]
RewriteRule ^PamFaxInstaller.dmg %{ENV:PAMFAX_DOWNLOAD_URI}files/PamFaxInstallerA%1.dmg [L,QSA]

RewriteRule ^(en/|de/|)PamFaxInstaller.exe %{ENV:PAMFAX_DOWNLOAD_URI}files/PamFaxInstaller.exe [L,QSA]
RewriteRule ^(en/|de/|)PamFaxInstaller.dmg %{ENV:PAMFAX_DOWNLOAD_URI}files/PamFaxInstaller.dmg [L,QSA]

# Full installer
RewriteRule ^(en/|de/|)PamFaxFullInstaller.exe %{ENV:PAMFAX_DOWNLOAD_URI}files/PamFaxFullInstaller.exe [L,QSA]

# ModSecurity
<IfModule mod_security.c>
  SecFilterSelective ARGS_VALUES "\x0a[[:space:]]*(subject|to|bcc|cc)[[:space:]]*:.*@"
</IfModule>

#php_value session.cookie_domain ".pamfax.biz"
php_value session.cookie_httponly Off

# redirect NoCache files to the real ones
RewriteRule (.*)_nc=([0-9]+)/(.*)\?(.*) $1$3&_nc=$2 [L,QSA]
RewriteRule (.*)_nc=([0-9]+)/(.*) $1$3?_nc=$2 [L,QSA]
RewriteRule (.*)nc([0-9]+)/(.*)\?(.*) $1$3&_nc=$2 [L,QSA]
RewriteRule (.*)nc([0-9]+)/(.*) $1$3?_nc=$2 [L,QSA]

RewriteRule ^contact_(..) http://www.pamhelp.com/?/pamfax/Tickets/Submit [R=301,L]
RewriteRule ^en/contact http://www.pamhelp.com/?/pamfax/Tickets/Submit [R=301,L]
RewriteRule ^contact http://www.pamhelp.com/?/pamfax/Tickets/Submit [R=301,L]
RewriteRule ^ja/contact http://www.pamhelp.com/?/pamfax/Tickets/Submit [R=301,L]
RewriteRule ^de/kontakt http://www.pamhelp.com/?/pamfax/Tickets/Submit [R=301,L]
RewriteRule ^ondemandrates_(..).php(.*) rates/costs/ [R=301,L]
RewriteRule ^ondemandrates.php(.*) rates/costs/ [R=301,L]
RewriteRule ^ondemandrates(.*) rates/costs/ [R=301,L]
RewriteRule ^(de|en|ja)/rates/pay-as-you-go-fax $1/rates/ [R=301,L]
RewriteRule rates/pay-as-you-go-fax rates/costs/ [R=301,L]
RewriteRule ^prepaidrates.php rates/costs/ [R=301,L]
RewriteRule ^prepaidrates rates/costs/ [R=301,L]
RewriteRule ^professionalrates.php shop/pamfax_professional_fax_plan [R=301,L]
RewriteRule ^professionalrates shop/pamfax_professional_fax_plan [R=301,L]
RewriteRule ^shots.php(.*) $1 [R=301,L]
RewriteRule ^shots(.*) /$1 [R=301,L]
RewriteRule ^terms(/|$|.php) /terms-of-use/ [R=301,L]
RewriteRule ^rates.php /en/rates/ [R=301,L]
RewriteRule ^fax-number(.*) introduction/fax-number/$1 [R=301,L]
RewriteRule ^de/fax-nummer(.*) de/einfuehrung/faxnummer/ [R=301,L]
RewriteRule ^images/shot_1.png images/screenshots/shot_1.png [R=301,L]
RewriteRule /downloads/linux /downloads [R=301,L]
RewriteRule /introduction/fax-linux(/|$) /introduction/ [R=301,L]

# 3.0:
RewriteRule extensions/vista-sidebar extensions/fax-gadget/ [R=301,L]

#en
RewriteRule rates/professional-plan(.*) shop/pamfax_professional_fax_plan [R=301,L]
RewriteRule rates/basic-plan(.*) shop/pamfax_basic_plan [R=301,L]
RewriteRule rates/ondemandrates(.*) rates/costs/ [R=301,L]
RewriteRule rates/on-demand rates/costs/ [R=301,L]
RewriteRule ^en/support(.*) http://www.pamhelp.com/?/pamfax/Knowledgebase/List [R=301,L,QSA]
RewriteRule ^en/partners/$ /en [R=301,L]
RewriteRule ^(en|ja)/rates/prepaid-fax rates/costs/ [R=301,L]
RewriteRule ^en/introduction/fax-software /downloads/ [R=301,L]
RewriteRule ^en/introduction/fax-number.php /en/introduction/fax-number/ [R=301,L]
RewriteRule ^en/developers/$ /en/developers/introduction/ [R=301,L]

#de
RewriteRule ^de/kosten/fax-bedarf de/kosten/gebuehren/ [R=301,L]
RewriteRule kosten/on-demand de/kosten/gebuehren/ [R=301,L]
RewriteRule kosten/fax-abonnement de/kosten/ [R=301,L]
RewriteRule ^de/rates/costs(/|$) de/kosten/gebuehren/ [R=301,L]
RewriteRule ^de/rates de/kosten/ [R=301,L]
RewriteRule ^de/imprint(/|$) de/impressum$1 [R=301,L]
RewriteRule ^de/terms-of-use(.*) de/nutzungsbedingungen$1 [R=301,L]
RewriteRule ^de/terms(/|$) de/nutzungsbedingungen$1 [R=301,L]
RewriteRule ^de/policy(/|$) de/datenschutz$1 [R=301,L]
RewriteRule ^de/einfuehrung/fax-linux/ de/einfuehrung/ [R=301,L]
RewriteRule ^de/einfuehrung/fax-number(/|$) de/einfuehrung/faxnummer/ [R=301,L]

RewriteRule ^de/introduction/fax-number/(.*) einfuehrung/faxnummer$1 [R=301,L]
RewriteRule ^de/introduction/how-to-fax(.*) einfuehrung/fax-anleitung$1 [R=301,L]
RewriteRule ^de/introduction(.*) einfuehrung$1 [R=301,L]
RewriteRule ^de/extensions/windows-gadget(.*) erweiterungen/fax-gadget$1 [R=301,L]
RewriteRule ^de/extensions(.*) erweiterungen$1 [R=301,L]
RewriteRule ^de/developers/$ /en/developers/introduction/ [R=301,L]
RewriteRule ^de/erweiterungen/developers/ /en/developers/introduction/ [R=301,L]
RewriteRule ^de/einfuehrung/fax-software /downloads/ [R=301,L]
RewriteRule kosten/professional-plan(.*) de/shop/pamfax_professional_fax_plan [R=301,L]
RewriteRule kosten/basic-plan(.*) de/shop/pamfax_basic_plan [R=301,L]
RewriteRule ^de/kosten/fax-abonnement(.*) de/shop/pamfax_professional_fax_plan [R=301,L]
RewriteRule ^kosten/fax-bedarf(.*) de/kosten/gebuehren/ [R=301,L]
RewriteRule ^kosten/bei-bedarf(.*) de/kosten/gebuehren/ [R=301,L]
RewriteRule ^de/support(.*) http://www.pamhelp.com/?/pamfax/Knowledgebase/List [R=301,L,QSA]
RewriteRule ^de/forum(.*) http://www.pamhelp.com/?/pamfax/Knowledgebase/List [R=301,L,QSA]

#ja
RewriteRule ^ja/support(.*) http://www.pamhelp.com/?/pamfax/Knowledgebase/List [R=301,L,QSA]
RewriteRule ^ja/terms(/|$) ja/terms-of-use [R=301,L]
RewriteRule ^ja/forum(.*) http://www.pamhelp.com/?/pamfax/Knowledgebase/List [R=301,L,QSA]
RewriteRule ^ja/developers/$ /ja/developers/introduction/ [R=301,L]
RewriteRule ^ja/extensions/developers/ /ja/developers/introduction/ [R=301,L]
RewriteRule ^ja/introduction/fax-software /downloads/ [R=301,L]

# redirect sub-pages from non-existent country-pages:
RewriteCond %{REQUEST_URI} !wp-admin [NC]
RewriteCond %{REQUEST_URI} !wp-includes/ [NC]
RewriteCond %{REQUEST_URI} !wp-login.php [NC]
RewriteCond %{REQUEST_URI} !/voucher(/|$) [NC]
RewriteCond %{REQUEST_URI} !/recommend(/|$) [NC]
RewriteRule ^(it|pl|ru|es|zh-Hant|zh-Hans|fr|sv)/(.+)$ /en/$2 [R=301,L]


# support
RewriteRule ^forum /support/ [R=301,L]
RewriteRule /heartbeat / [R=301,L]


# FAQ:
# "document types":
RewriteRule faq/content/3/22/ /KB53 [R=301,L]
RewriteRule faq/3_22 /KB53 [R=301,L]
# "how to pay":
RewriteRule faq/content/1/8/ /KB4 [R=301,L]
# "system requirements":
RewriteRule faq/content/2/2/ /KB29 [R=301,L]
# "from office?":
RewriteRule faq/content/3/7/ /KB47 [R=301,L]
# "how do i knwo fax was sent":
RewriteRule faq/content/3/10/ /KB49 [R=301,L]
# "receive?":
RewriteRule faq/content/1/21/ /KB5 [R=301,L]
# "how easy?":
RewriteRule faq/content/3/9/ /KB48 [R=301,L]
# "allow skype API access":
RewriteRule faq/content/1/97/ /KB49 [R=301,L]
RewriteRule faq/1_97 /KB46 [R=301,L]
# "line costs":
RewriteRule faq/content/3/42/ /KB60 [R=301,L]
RewriteRule faq/3_42 /KB60 [R=301,L]

# knowledge base shortlink:
RewriteRule ^(de/|ja/|en/|)kb([0-9]+) http://www.pamhelp.com/?/pamfax/Knowledgebase/Article/View/$2 [NC,R=302,L]
RewriteRule ^(de/|ja/|en/|)faq/([0-9]+) http://www.pamhelp.com/?/pamfax/Knowledgebase/Article/View/$2 [R=301,L]
RewriteRule ^(de/|ja/|en/|)faq($|/) http://www.pamhelp.com/?/pamfax/Knowledgebase/List [R=301,L]

# TODO: add tracking to page setupcanceled and then forward from that page:
RewriteRule ^setupcanceled /download/?showfull=1
# the page that is opened when light installer download failes (see #7395)
#RewriteRule ^DownloadFullInstaller %{ENV:PAMFAX_DOWNLOAD_URI}files/PamFaxFullInstaller.exe?origin=lightinstaller [L,R]
RewriteRule ^DownloadFullInstaller /en/downloads/windows/?origin=lightinstaller&file=PamFaxFullInstaller.exe [L,R]


# Start iDevAffiliate SEO Code

# Forced Tier Linking Code
RewriteRule ^signup-([0-9]+)\.html http://www\.pamfax\.biz/affiliate/signup\.php?ref=$1 [R=301,L]

# TextAds
RewriteRule ^([0-9]+)-([a-z]+)-([0-9]+)\.html http://www\.pamfax\.biz/affiliate/idevads\.php?id=$1&ad=$3 [R=301,L]
RewriteRule ^([0-9]+)-([a-z]+)-([0-9]+)-([0-9]+)\.html http://www\.pamfax\.biz/affiliate/idevads\.php?id=$1&ad=$3&page=$4 [R=301,L]

# Custom Links
RewriteRule ^([0-9]+)-([a-zA-Z0-9-]+)-([0-9]+)-url\.html http://www\.pamfax\.biz/affiliate/idevaffiliate\.php?id=$1&keyword=$2&url=$3 [R=301,L]
RewriteRule ^([0-9]+)-([a-zA-Z0-9-]+)-([0-9]+)-custom\.html http://www\.pamfax\.biz/affiliate/idevaffiliate\.php?id=$1&keyword=$2&custom=$3 [R=301,L]

# Standard Links
RewriteRule ^([0-9]+)\.html http://www\.pamfax\.biz/affiliate/idevaffiliate\.php?id=$1 [R=301,L]
RewriteRule ^([0-9]+)-([0-9]+)\.html http://www\.pamfax\.biz/affiliate/idevaffiliate\.php?id=$1&page=$2 [R=301,L]
RewriteRule ^([0-9]+)-([0-9]+)-([0-9]+)\.html http://www\.pamfax\.biz/affiliate/idevaffiliate\.php?id=$1&page=$2&set=$3 [R=301,L]
RewriteRule ^([0-9]+)-([0-9]+)-([0-9]+)-([0-9]+)\.html http://www\.pamfax\.biz/affiliate/idevaffiliate\.php?id=$1&page=$2&set=$3&link=$4 [R=301,L]
RewriteRule ^([0-9]+)-([0-9]+)-([0-9]+)-([0-9]+)-([a-zA-Z]+)\.html http://www\.pamfax\.biz/affiliate/idevaffiliate\.php?id=$1&page=$2&set=$3&link=$4&keyword=$5 [R=301,L]
RewriteRule ^([0-9]+)-([0-9]+)-([0-9]+)-([0-9]+)-([a-zA-Z]+)-([0-9]+)\.html http://www\.pamfax\.biz/affiliate/idevaffiliate\.php?id=$1&page=$2&set=$3&link=$4&keyword=$5&custom=$6 [R=301,L]
RewriteRule ^([0-9]+)-([0-9]+)-([0-9]+)-([0-9]+)-([a-zA-Z]+)-([0-9]+)-([0-9]+)\.html http://www\.pamfax\.biz/affiliate/idevaffiliate\.php?id=$1&page=$2&set=$3&link=$4&keyword=$5&custom=$6&url=$7 [R=301,L]
# End iDevAffiliate SEO Code

# redirect links like index_1.php, index_ja.php to main index.file
RewriteRule /index_([a-zA-Z]*).php  $1/ [R=301,L]
RewriteRule /index_([0-9]).php  / [R=301,L]

# correct some 404:
RewriteRule /from_Skype  / [R=301,L]
RewriteRule /siteopt.js  / [R=301,L]
RewriteRule ^jp/  /ja/ [R=301,L]

# have pamfax.biz as forwarder url for pamnews:
RewriteRule ^news/(.*) http://www\.pamnews\.com/$1 [R=301,L]

# language defaults to EN
SetEnvIf Request_URI (.*) PAMFAX_WEB_SUBFOLDER=en

# Language Redirects by geoip
# JP
SetEnvIf GEOIP_COUNTRY_CODE JP PAMFAX_WEB_SUBFOLDER=ja
SetEnvIf GEOIP_COUNTRY_CODE JA PAMFAX_WEB_SUBFOLDER=ja
# CN (simplified)
SetEnvIf GEOIP_COUNTRY_CODE CN PAMFAX_WEB_SUBFOLDER=zh-Hans
SetEnvIf GEOIP_COUNTRY_CODE SG PAMFAX_WEB_SUBFOLDER=zh-Hans
# CN (traditional)
SetEnvIf GEOIP_COUNTRY_CODE TW PAMFAX_WEB_SUBFOLDER=zh-Hant
SetEnvIf GEOIP_COUNTRY_CODE HK PAMFAX_WEB_SUBFOLDER=zh-Hant
SetEnvIf GEOIP_COUNTRY_CODE MO PAMFAX_WEB_SUBFOLDER=zh-Hant
# IT
SetEnvIf GEOIP_COUNTRY_CODE IT PAMFAX_WEB_SUBFOLDER=it
# DE
SetEnvIf GEOIP_COUNTRY_CODE DE PAMFAX_WEB_SUBFOLDER=de
SetEnvIf GEOIP_COUNTRY_CODE AT PAMFAX_WEB_SUBFOLDER=de
SetEnvIf GEOIP_COUNTRY_CODE CH PAMFAX_WEB_SUBFOLDER=de
# RU
SetEnvIf GEOIP_COUNTRY_CODE RU PAMFAX_WEB_SUBFOLDER=ru
# ES
SetEnvIf GEOIP_COUNTRY_CODE ES PAMFAX_WEB_SUBFOLDER=es
SetEnvIf GEOIP_COUNTRY_CODE MX PAMFAX_WEB_SUBFOLDER=es
SetEnvIf GEOIP_COUNTRY_CODE GT PAMFAX_WEB_SUBFOLDER=es
SetEnvIf GEOIP_COUNTRY_CODE CR PAMFAX_WEB_SUBFOLDER=es
SetEnvIf GEOIP_COUNTRY_CODE PA PAMFAX_WEB_SUBFOLDER=es
SetEnvIf GEOIP_COUNTRY_CODE DO PAMFAX_WEB_SUBFOLDER=es
SetEnvIf GEOIP_COUNTRY_CODE VE PAMFAX_WEB_SUBFOLDER=es
SetEnvIf GEOIP_COUNTRY_CODE CO PAMFAX_WEB_SUBFOLDER=es
SetEnvIf GEOIP_COUNTRY_CODE PE PAMFAX_WEB_SUBFOLDER=es
SetEnvIf GEOIP_COUNTRY_CODE AR PAMFAX_WEB_SUBFOLDER=es
SetEnvIf GEOIP_COUNTRY_CODE EC PAMFAX_WEB_SUBFOLDER=es
SetEnvIf GEOIP_COUNTRY_CODE CL PAMFAX_WEB_SUBFOLDER=es
SetEnvIf GEOIP_COUNTRY_CODE UY PAMFAX_WEB_SUBFOLDER=es
SetEnvIf GEOIP_COUNTRY_CODE PY PAMFAX_WEB_SUBFOLDER=es
SetEnvIf GEOIP_COUNTRY_CODE BO PAMFAX_WEB_SUBFOLDER=es
SetEnvIf GEOIP_COUNTRY_CODE SV PAMFAX_WEB_SUBFOLDER=es
SetEnvIf GEOIP_COUNTRY_CODE HN PAMFAX_WEB_SUBFOLDER=es
SetEnvIf GEOIP_COUNTRY_CODE NI PAMFAX_WEB_SUBFOLDER=es
SetEnvIf GEOIP_COUNTRY_CODE PR PAMFAX_WEB_SUBFOLDER=es
# FR
SetEnvIf GEOIP_COUNTRY_CODE FR PAMFAX_WEB_SUBFOLDER=fr
SetEnvIf GEOIP_COUNTRY_CODE BE PAMFAX_WEB_SUBFOLDER=fr
SetEnvIf GEOIP_COUNTRY_CODE MC PAMFAX_WEB_SUBFOLDER=fr
# SV
SetEnvIf GEOIP_COUNTRY_CODE SV PAMFAX_WEB_SUBFOLDER=sv

# Language Redirects by browser language
# JP
SetEnvIfNoCase Accept-Language "^ja" PAMFAX_WEB_SUBFOLDER=ja
# CN (simplified)
SetEnvIfNoCase Accept-Language "^zh" PAMFAX_WEB_SUBFOLDER=zh-Hans
# CN (traditional)
SetEnvIfNoCase Accept-Language "^zh-hant" PAMFAX_WEB_SUBFOLDER=zh-Hant
SetEnvIfNoCase Accept-Language "^zh-cht" PAMFAX_WEB_SUBFOLDER=zh-Hant
SetEnvIfNoCase Accept-Language "^zh-hk" PAMFAX_WEB_SUBFOLDER=zh-Hant
SetEnvIfNoCase Accept-Language "^zh-tw" PAMFAX_WEB_SUBFOLDER=zh-Hant
SetEnvIfNoCase Accept-Language "^zh-mo" PAMFAX_WEB_SUBFOLDER=zh-Hant
# IT
SetEnvIfNoCase Accept-Language "^it" PAMFAX_WEB_SUBFOLDER=it
# DE
SetEnvIfNoCase Accept-Language "^de" PAMFAX_WEB_SUBFOLDER=de
# RU
SetEnvIfNoCase Accept-Language "^ru" PAMFAX_WEB_SUBFOLDER=ru
# ES
SetEnvIfNoCase Accept-Language "^es" PAMFAX_WEB_SUBFOLDER=es
# FR
SetEnvIfNoCase Accept-Language "^fr" PAMFAX_WEB_SUBFOLDER=fr
# SV
SetEnvIfNoCase Accept-Language "^sv" PAMFAX_WEB_SUBFOLDER=sv
# EN
SetEnvIfNoCase Accept-Language "^en" PAMFAX_WEB_SUBFOLDER=en

# and geoip can be overwritten by cookie (mantis #5572)
SetEnvIf Cookie "selected_language=(en|de|ja|es|ru|it|pl|zh-Hant|zh-Hans|fr|sv)" PAMFAX_WEB_SUBFOLDER=$1

# language redirects
RewriteCond %{HTTP_HOST} ^(dev|www)\.pamfax\.biz [NC]
RewriteCond %{ENV:PAMFAX_WEB_SUBFOLDER} !^$
RewriteCond %{ENV:REDIRECT_STATUS} ^$
RewriteCond %{REQUEST_URI} !/shop/	[NC]
RewriteCond %{REQUEST_URI} !/affiliate/	[NC]
RewriteCond %{REQUEST_URI} !/images/	[NC]
RewriteCond %{REQUEST_URI} !/media/	[NC]
RewriteCond %{REQUEST_URI} !/share/
RewriteCond %{REQUEST_URI} !/wp-	[NC]
RewriteCond %{REQUEST_URI} !^/(de|en|ja|it|pl|ru|es|zh-Hant|zh-Hans|fr|sv)(/|$)
RewriteCond %{REQUEST_URI} !([0-9\-]).html	[NC]
RewriteCond %{REQUEST_URI} !^/header-external.php	[NC]
RewriteCond %{REQUEST_URI} !^/footer-external.php	[NC]
RewriteCond %{REQUEST_URI} !^/robots.txt	[NC]
RewriteCond %{REQUEST_URI} !.(xml|ico|html)$	[NC]
RewriteCond %{REQUEST_URI} !^/api.php	[NC]
RewriteCond %{REQUEST_URI} !^/go.php
RewriteCond %{REQUEST_URI} !^/clickheat/
RewriteCond %{REQUEST_URI} !/trackconv.php	[NC]
RewriteRule ^(.*)$ /%{ENV:PAMFAX_WEB_SUBFOLDER}/$1 [R=302,L,QSA]


############# performance optimization #####################
#DeflateCompressionLevel 5
#DeflateBufferSize 2048

<IfModule mod_deflate.c>
<FilesMatch "(\.(js|css|html|gif))|(\_js\.php)$">
SetOutputFilter DEFLATE
</FilesMatch>
</IfModule>

<IfModule mod_headers.c>
<FilesMatch "(\.(ico|pdf|flv|jpg|jpeg|png|gif|js|css|swf|gz))|(\_js\.php)?$">
Header unset ETag
FileETag None
</FilesMatch>

<FilesMatch "\_js\.php$">
Header unset Pragma
Header unset Cache-Control
</FilesMatch>

################ Expires Control ################
ExpiresActive On
ExpiresDefault A0
<FilesMatch "\.(gif|jpg|jpeg|png|swf|ico)$">
    ExpiresDefault "now plus 5 weeks"
    Header append Cache-Control "public"
</FilesMatch>
<FilesMatch "\.(xml|txt|html)$">
    ExpiresDefault "now plus 2 hours"
    Header append Cache-Control "proxy-revalidate"
</FilesMatch>
<FilesMatch "(\.(js|css))|(\_js\.php)$">
    ExpiresDefault "now plus 5 weeks"
    Header append Cache-Control "proxy-revalidate"
</FilesMatch>
</IfModule>

# BEGIN WordPress
RewriteRule ^index\.php$ - [L]
#RewriteRule sitemap\.xml$ index.php?sitemap=1 [QSA,L]

# uploaded files
RewriteRule ^([_0-9a-zA-Z-]+/)?files/(.+)  wp-includes/ms-files.php?file=$2 [L]

# add a trailing slash to /wp-admin
RewriteRule ^([_0-9a-zA-Z-]+/)?wp-admin$ $1wp-admin/ [R=301,L]

RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]
RewriteRule  ^([_0-9a-zA-Z-]+/)?(wp-(content|admin|includes).*) $2 [L]
RewriteRule  ^([_0-9a-zA-Z-]+/)?(.*.php)$ $2 [L]
RewriteRule . index.php [L]


# END WordPress
